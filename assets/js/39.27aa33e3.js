(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{487:function(A,C){A.exports="data:image/png;base64,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btv3GwmvyP5dE8FCIfYv3gZ+odA62WBF2MHStV9AsAAAKhAsAIAKBAsAoALBAgCoQLAAACoQLACACgQLAKACwQIAqECwAAAqECwAgAoECwCgAsECAKhAsAAAKhAsAIAKBAsAoALBAgCoQLAAACoQLACACgQLAKACwQIAqECwAAAqECwAgAoECwCgAsECAKhAsAAAKhAsAIAKBAsAoALBAgCoQLAAACoQLACACgQLAKACwQIAqECwAAAqECwAgAoECwCgAsECAKhAsAAAKhAsAIAKBAsAoALBAgCoQLAAACoQLACACgQLAKACwQIAqECwAAAqECwAgAoECwCgAsECAKhAsAAAKhAsAIAKBAsAoALBAgCoQLAAACoQLACACgQLAKACwQIAqECwAAAqECwAgAoECwCgAsECAKhAsAAAKhAsAIAKBAsAoALBAgCoQLAAACoQLACACgQLAKACwQIAqECwAAAqECwAgAoECwCgAsECAKhAsJa68aJ69enP1ZvbT/y3AwCKIFhLESwA2AuCtRTBAoC9OIlgPbxdB6WOyvOz+t8SmNbb6ukNd/kn1XNzu3W/mWUmTMDuVU8vmp9NH6vbLt821GQ7L15Ud8yyPbNu2Y7X1cPgMvvx8dX31bcvv6++enQ+vf3Dy+qr+rZvn11W77m3AUCi0wrWTTtWvT4I7bJnr8e3WV7dvGetc7/BemqHqNdFdAjWc88y421eWSRKErPLi/HPASDHSQVrOojXMbktwZKwuDMqicJMWIIzmoXBanUzKHNbHdZxsGq+8No/2wN/mO5Xl03IXl5XH1vLAkCu0wpW7DCZDPKeZe7cfNveNj00WFs9WIHbW6GYDjOvUejWdnHdBsueZb336GX4UCEAZDi977A8t7cihwOF9xDb2sGKzpJCYZLH3HOwfnFeffasmU29rD770PdvANgdwRIEqwiZUX17dX+YcTX/7VkWAHIQLNEHK/tEhdlghcIUDllLabDs76wuOdkCQEEEy5DB37dcc1tg8JewROIg34HZUTM/O7pgWbOsBqeyAyiEYNmihwVDg7/EwWHPuEzUbHIq+vEFy5ziXuNkCwClEKyJYaZlxyU+8Hvu4xwiHGZUjW59/kOFPc3B4mQLACs4iWBhz/jLFgBWQLBQmMyuONkCQFkEC4XI2YGCv2wBoCyChULsYBErAOURLACACgQLAKACwQIAqECwAAAqECwAgAoECwCgAsECAKhAsAAAKhAsAIAKBAsAoALBAgCoQLAAACoQLACACgQLAKACwQIAqECwAAAqECwAgAoECwCgAsECAKhAsAAAKhAsAIAKBAsAoALBAgCoQLAAAAr8qvp/UA5GbquDVQgAAAAASUVORK5CYII="},488:function(A,C,s){A.exports=s.p+"assets/img/maclonlin.16deaee5.png"},635:function(A,C,s){"use strict";s.r(C);var g=s(44),v=Object(g.a)({},(function(){var A=this,C=A.$createElement,g=A._self._c||C;return g("ContentSlotsDistributor",{attrs:{"slot-key":A.$parent.slotKey}},[g("hr"),A._v(" "),g("h1",{attrs:{id:"self-attention的优化"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#self-attention的优化"}},[A._v("#")]),A._v(" Self attention的优化")]),A._v(" "),g("h2",{attrs:{id:"复杂度"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#复杂度"}},[A._v("#")]),A._v(" 复杂度")]),A._v(" "),g("p",[A._v("Softmax(QK)V (忽略除以维度)\n由于QK是O(n"),g("strong",[A._v("2), n代表序列长度， d为单头的维度，通常  n >> d. (bert base 512 > 64)\n因此整个是O(n")]),A._v("2)")]),A._v(" "),g("h2",{attrs:{id:"问题"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[A._v("#")]),A._v(" 问题")]),A._v(" "),g("p",[A._v("由于复杂度本身造成空间和时间都是输入序列的二次方，因此经常出现微调模型Oom, 或者\n微调耗时很长。")]),A._v(" "),g("h2",{attrs:{id:"解决办法"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#解决办法"}},[A._v("#")]),A._v(" 解决办法")]),A._v(" "),g("ol",[g("li",[g("p",[A._v("基于稀疏计算的方法")])]),A._v(" "),g("li",[g("p",[A._v("基于序列维度缩减\n代表方法： Linformer\n思想： 设m<n 且m为一个常数。")]),A._v(" "),g("ol",[g("li",[A._v("把K由n"),g("em",[A._v("d 矩阵乘法参数映射--\x3e m * d 再和Q乘得到 n")]),A._v(" m")]),A._v(" "),g("li",[A._v("把V由n*d 矩阵乘法参数映射--\x3e m * d")]),A._v(" "),g("li",[A._v("softmax(1.) * 2. --\x3e n"),g("em",[A._v("d\n但是这个方法可能对很长序列选取的m有不短的长度要求。\n其他的思路还可以考虑对Q 参数映射--\x3e m * d, 在和Q乘得到 m * n再和v乘\n得到 m * d, 最后参数映射--\x3e n")]),A._v("d。这些方法不一定满足预训练微调的指标要求，但\n应该满足蒸馏的微调模型的要求。")])])]),A._v(" "),g("li",[g("p",[A._v("基于矩阵结合律\nSoftmax(QK)V (忽略除以维度)是不满足结合律的。考虑QKV,如果Kv先乘，复杂度d**2+n"),g("em",[A._v("d\n即接近线性。\n但是QK不满足分布要求。\n我们考虑softmax操作： QK乘完，实际上是按照元素取exp, 然后对最后维度除以一个统一值\n概率化。对最后维度的除法，是不改变输出维度，可以后置，不考虑。主要造成不能满足结合律的\n是按元素取exp, 因为exp(x1")]),A._v("y1) 不知道= func1(x1) * func2(y1)，这个func1, 2\n是什么不知道，所以没办法拆开。\n但是实际上，我们只需要这里QK的结果最后维度都是正值且可以分开操作就可以了，这个其实可以通过很多方式\n实现。")]),A._v(" "),g("ol",[g("li",[A._v("分开softmax\nsoftmax(Q, dim=-1)softmax(K,dim=-2) * V = softmax(Q,dim=-1) * (softmax(K,dim=-2) * V)")]),A._v(" "),g("li",[A._v("elu"),g("br"),A._v(" "),g("img",{attrs:{src:s(487),alt:"elu"}})])]),A._v(" "),g("p",[A._v("还有人希望函数近似的：泰勒展开式\n但是不太合里：\nexp(x) = 1 + x\n这个是麦克劳林公式，在这用不合理。我尝试指出了问题：\n"),g("img",{attrs:{src:s(488),alt:"mac_lao"}}),A._v("\n.\n.")]),A._v(" "),g("p",[g("a",{attrs:{href:"https://kexue.fm/archives/7546",target:"_blank",rel:"noopener noreferrer"}},[A._v("reference"),g("OutboundLink")],1)])])])])}),[],!1,null,null,null);C.default=v.exports}}]);